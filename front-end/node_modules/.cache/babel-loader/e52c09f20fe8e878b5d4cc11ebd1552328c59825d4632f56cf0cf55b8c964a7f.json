{"ast":null,"code":"import { Agent } from '@web3-storage/access/agent';\nimport { serviceConf, receiptsEndpoint } from './service.js';\nexport class Base {\n  /**\n   * @type {Agent}\n   * @protected\n   */\n  _agent;\n  /**\n   * @type {import('./types.js').ServiceConf}\n   * @protected\n   */\n  _serviceConf;\n  /**\n   * @param {import('@web3-storage/access').AgentData} agentData\n   * @param {object} [options]\n   * @param {import('./types.js').ServiceConf} [options.serviceConf]\n   * @param {URL} [options.receiptsEndpoint]\n   */\n  constructor(agentData, options = {}) {\n    this._serviceConf = options.serviceConf ?? serviceConf;\n    this._agent = new Agent(agentData, {\n      servicePrincipal: this._serviceConf.access.id,\n      // @ts-expect-error I know but it will be HTTP for the forseeable.\n      url: this._serviceConf.access.channel.url,\n      connection: this._serviceConf.access\n    });\n    this._receiptsEndpoint = options.receiptsEndpoint ?? receiptsEndpoint;\n  }\n  /**\n   * The current user agent (this device).\n   *\n   * @type {Agent}\n   */\n  get agent() {\n    return this._agent;\n  }\n  /**\n   * @protected\n   * @param {import('./types.js').Ability[]} abilities\n   */\n  async _invocationConfig(abilities) {\n    const resource = this._agent.currentSpace();\n    if (!resource) {\n      throw new Error('missing current space: use createSpace() or setCurrentSpace()');\n    }\n    const issuer = this._agent.issuer;\n    const proofs = await this._agent.proofs(abilities.map(can => ({\n      can,\n      with: resource\n    })));\n    const audience = this._serviceConf.upload.id;\n    return {\n      issuer,\n      with: resource,\n      proofs,\n      audience\n    };\n  }\n}","map":{"version":3,"names":["Agent","serviceConf","receiptsEndpoint","Base","_agent","_serviceConf","constructor","agentData","options","servicePrincipal","access","id","url","channel","connection","_receiptsEndpoint","agent","_invocationConfig","abilities","resource","currentSpace","Error","issuer","proofs","map","can","with","audience","upload"],"sources":["../../src/base.js"],"sourcesContent":[null],"mappings":"AAAA,SAASA,KAAK,QAAQ,4BAA4B;AAClD,SAASC,WAAW,EAAEC,gBAAgB,QAAQ,cAAc;AAE5D,OAAM,MAAOC,IAAI;EACf;;;;EAIAC,MAAM;EAEN;;;;EAIAC,YAAY;EAEZ;;;;;;EAMAC,YAAYC,SAAS,EAAEC,OAAO,GAAG,EAAE;IACjC,IAAI,CAACH,YAAY,GAAGG,OAAO,CAACP,WAAW,IAAIA,WAAW;IACtD,IAAI,CAACG,MAAM,GAAG,IAAIJ,KAAK,CAACO,SAAS,EAAE;MACjCE,gBAAgB,EAAE,IAAI,CAACJ,YAAY,CAACK,MAAM,CAACC,EAAE;MAC7C;MACAC,GAAG,EAAE,IAAI,CAACP,YAAY,CAACK,MAAM,CAACG,OAAO,CAACD,GAAG;MACzCE,UAAU,EAAE,IAAI,CAACT,YAAY,CAACK;KAC/B,CAAC;IACF,IAAI,CAACK,iBAAiB,GAAGP,OAAO,CAACN,gBAAgB,IAAIA,gBAAgB;EACvE;EAEA;;;;;EAKA,IAAIc,KAAKA,CAAA;IACP,OAAO,IAAI,CAACZ,MAAM;EACpB;EAEA;;;;EAIA,MAAMa,iBAAiBA,CAACC,SAAS;IAC/B,MAAMC,QAAQ,GAAG,IAAI,CAACf,MAAM,CAACgB,YAAY,EAAE;IAC3C,IAAI,CAACD,QAAQ,EAAE;MACb,MAAM,IAAIE,KAAK,CACb,+DAA+D,CAChE;;IAEH,MAAMC,MAAM,GAAG,IAAI,CAAClB,MAAM,CAACkB,MAAM;IACjC,MAAMC,MAAM,GAAG,MAAM,IAAI,CAACnB,MAAM,CAACmB,MAAM,CACrCL,SAAS,CAACM,GAAG,CAAEC,GAAG,KAAM;MAAEA,GAAG;MAAEC,IAAI,EAAEP;IAAQ,CAAE,CAAC,CAAC,CAClD;IACD,MAAMQ,QAAQ,GAAG,IAAI,CAACtB,YAAY,CAACuB,MAAM,CAACjB,EAAE;IAC5C,OAAO;MAAEW,MAAM;MAAEI,IAAI,EAAEP,QAAQ;MAAEI,MAAM;MAAEI;IAAQ,CAAE;EACrD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}