{"ast":null,"code":"import { Usage as UsageCapabilities } from '@web3-storage/capabilities';\nimport * as API from '../types.js';\nimport { Base } from '../base.js';\n/**\n * Client for interacting with the `usage/*` capabilities.\n */\nexport class UsageClient extends Base {\n  /**\n   * Get a usage report for the passed space in the given time period.\n   *\n   * Required delegated capabilities:\n   * - `usage/report`\n   *\n   * @param {import('../types.js').SpaceDID} space\n   * @param {{ from: Date, to: Date }} period\n   * @param {object} [options]\n   * @param {string} [options.nonce]\n   */\n  async report(space, period, options) {\n    const out = await report({\n      agent: this.agent\n    }, {\n      ...options,\n      space,\n      period\n    });\n    /* c8 ignore next 7 */\n    if (!out.ok) {\n      throw new Error(`failed ${UsageCapabilities.report.can} invocation`, {\n        cause: out.error\n      });\n    }\n    return out.ok;\n  }\n}\n/**\n * Get a usage report for the period.\n *\n * @param {{agent: API.Agent}} client\n * @param {object} options\n * @param {API.SpaceDID} options.space\n * @param {{ from: Date, to: Date }} options.period\n * @param {string} [options.nonce]\n * @param {API.Delegation[]} [options.proofs]\n * @returns {Promise<API.Result<API.UsageReportSuccess, API.UsageReportFailure>>}\n */\nexport const report = async ({\n  agent\n}, {\n  space,\n  period,\n  nonce,\n  proofs = []\n}) => {\n  const receipt = await agent.invokeAndExecute(UsageCapabilities.report, {\n    with: space,\n    proofs,\n    nonce,\n    nb: {\n      period: {\n        from: Math.floor(period.from.getTime() / 1000),\n        to: Math.ceil(period.to.getTime() / 1000)\n      }\n    }\n  });\n  return receipt.out;\n};","map":{"version":3,"names":["Usage","UsageCapabilities","API","Base","UsageClient","report","space","period","options","out","agent","ok","Error","can","cause","error","nonce","proofs","receipt","invokeAndExecute","with","nb","from","Math","floor","getTime","to","ceil"],"sources":["../../../src/capability/usage.js"],"sourcesContent":[null],"mappings":"AAAA,SAASA,KAAK,IAAIC,iBAAiB,QAAQ,4BAA4B;AACvE,OAAO,KAAKC,GAAG,MAAM,aAAa;AAClC,SAASC,IAAI,QAAQ,YAAY;AAEjC;;;AAGA,OAAM,MAAOC,WAAY,SAAQD,IAAI;EACnC;;;;;;;;;;;EAWA,MAAME,MAAMA,CAACC,KAAK,EAAEC,MAAM,EAAEC,OAAO;IACjC,MAAMC,GAAG,GAAG,MAAMJ,MAAM,CACtB;MAAEK,KAAK,EAAE,IAAI,CAACA;IAAK,CAAE,EACrB;MAAE,GAAGF,OAAO;MAAEF,KAAK;MAAEC;IAAM,CAAE,CAC9B;IACD;IACA,IAAI,CAACE,GAAG,CAACE,EAAE,EAAE;MACX,MAAM,IAAIC,KAAK,CAAC,UAAUX,iBAAiB,CAACI,MAAM,CAACQ,GAAG,aAAa,EAAE;QACnEC,KAAK,EAAEL,GAAG,CAACM;OACZ,CAAC;;IAGJ,OAAON,GAAG,CAACE,EAAE;EACf;;AAGF;;;;;;;;;;;AAWA,OAAO,MAAMN,MAAM,GAAG,MAAAA,CACpB;EAAEK;AAAK,CAAE,EACT;EAAEJ,KAAK;EAAEC,MAAM;EAAES,KAAK;EAAEC,MAAM,GAAG;AAAE,CAAE,KACnC;EACF,MAAMC,OAAO,GAAG,MAAMR,KAAK,CAACS,gBAAgB,CAAClB,iBAAiB,CAACI,MAAM,EAAE;IACrEe,IAAI,EAAEd,KAAK;IACXW,MAAM;IACND,KAAK;IACLK,EAAE,EAAE;MACFd,MAAM,EAAE;QACNe,IAAI,EAAEC,IAAI,CAACC,KAAK,CAACjB,MAAM,CAACe,IAAI,CAACG,OAAO,EAAE,GAAG,IAAI,CAAC;QAC9CC,EAAE,EAAEH,IAAI,CAACI,IAAI,CAACpB,MAAM,CAACmB,EAAE,CAACD,OAAO,EAAE,GAAG,IAAI;;;GAG7C,CAAC;EACF,OAAOP,OAAO,CAACT,GAAG;AACpB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}