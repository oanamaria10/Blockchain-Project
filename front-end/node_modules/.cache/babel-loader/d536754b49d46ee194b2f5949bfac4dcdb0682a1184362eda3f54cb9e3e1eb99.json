{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { getCurrentHub } from '@sentry/core';\nimport { fill, logger, parseSemver } from '@sentry/utils';\nimport { cleanSpanDescription, extractUrl, isSentryRequest, normalizeRequestArgs } from './utils/http';\nvar NODE_VERSION = parseSemver(process.versions.node);\n/** http module integration */\nvar Http = /** @class */function () {\n  /**\n   * @inheritDoc\n   */\n  function Http(options) {\n    if (options === void 0) {\n      options = {};\n    }\n    /**\n     * @inheritDoc\n     */\n    this.name = Http.id;\n    this._breadcrumbs = typeof options.breadcrumbs === 'undefined' ? true : options.breadcrumbs;\n    this._tracing = typeof options.tracing === 'undefined' ? false : options.tracing;\n  }\n  /**\n   * @inheritDoc\n   */\n  Http.prototype.setupOnce = function () {\n    // No need to instrument if we don't want to track anything\n    if (!this._breadcrumbs && !this._tracing) {\n      return;\n    }\n    var wrappedHandlerMaker = _createWrappedRequestMethodFactory(this._breadcrumbs, this._tracing);\n    var httpModule = require('http');\n    fill(httpModule, 'get', wrappedHandlerMaker);\n    fill(httpModule, 'request', wrappedHandlerMaker);\n    // NOTE: Prior to Node 9, `https` used internals of `http` module, thus we don't patch it.\n    // If we do, we'd get double breadcrumbs and double spans for `https` calls.\n    // It has been changed in Node 9, so for all versions equal and above, we patch `https` separately.\n    if (NODE_VERSION.major && NODE_VERSION.major > 8) {\n      var httpsModule = require('https');\n      fill(httpsModule, 'get', wrappedHandlerMaker);\n      fill(httpsModule, 'request', wrappedHandlerMaker);\n    }\n  };\n  /**\n   * @inheritDoc\n   */\n  Http.id = 'Http';\n  return Http;\n}();\nexport { Http };\n/**\n * Function which creates a function which creates wrapped versions of internal `request` and `get` calls within `http`\n * and `https` modules. (NB: Not a typo - this is a creator^2!)\n *\n * @param breadcrumbsEnabled Whether or not to record outgoing requests as breadcrumbs\n * @param tracingEnabled Whether or not to record outgoing requests as tracing spans\n *\n * @returns A function which accepts the exiting handler and returns a wrapped handler\n */\nfunction _createWrappedRequestMethodFactory(breadcrumbsEnabled, tracingEnabled) {\n  return function wrappedRequestMethodFactory(originalRequestMethod) {\n    return function wrappedMethod() {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var httpModule = this;\n      var requestArgs = normalizeRequestArgs(args);\n      var requestOptions = requestArgs[0];\n      var requestUrl = extractUrl(requestOptions);\n      // we don't want to record requests to Sentry as either breadcrumbs or spans, so just use the original method\n      if (isSentryRequest(requestUrl)) {\n        return originalRequestMethod.apply(httpModule, requestArgs);\n      }\n      var span;\n      var parentSpan;\n      var scope = getCurrentHub().getScope();\n      if (scope && tracingEnabled) {\n        parentSpan = scope.getSpan();\n        if (parentSpan) {\n          span = parentSpan.startChild({\n            description: (requestOptions.method || 'GET') + \" \" + requestUrl,\n            op: 'request'\n          });\n          var sentryTraceHeader = span.toTraceparent();\n          logger.log(\"[Tracing] Adding sentry-trace header to outgoing request: \" + sentryTraceHeader);\n          requestOptions.headers = __assign(__assign({}, requestOptions.headers), {\n            'sentry-trace': sentryTraceHeader\n          });\n        }\n      }\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      return originalRequestMethod.apply(httpModule, requestArgs).once('response', function (res) {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var req = this;\n        if (breadcrumbsEnabled) {\n          addRequestBreadcrumb('response', requestUrl, req, res);\n        }\n        if (tracingEnabled && span) {\n          if (res.statusCode) {\n            span.setHttpStatus(res.statusCode);\n          }\n          span.description = cleanSpanDescription(span.description, requestOptions, req);\n          span.finish();\n        }\n      }).once('error', function () {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var req = this;\n        if (breadcrumbsEnabled) {\n          addRequestBreadcrumb('error', requestUrl, req);\n        }\n        if (tracingEnabled && span) {\n          span.setHttpStatus(500);\n          span.description = cleanSpanDescription(span.description, requestOptions, req);\n          span.finish();\n        }\n      });\n    };\n  };\n}\n/**\n * Captures Breadcrumb based on provided request/response pair\n */\nfunction addRequestBreadcrumb(event, url, req, res) {\n  if (!getCurrentHub().getIntegration(Http)) {\n    return;\n  }\n  getCurrentHub().addBreadcrumb({\n    category: 'http',\n    data: {\n      method: req.method,\n      status_code: res && res.statusCode,\n      url: url\n    },\n    type: 'http'\n  }, {\n    event: event,\n    request: req,\n    response: res\n  });\n}","map":{"version":3,"names":["getCurrentHub","fill","logger","parseSemver","cleanSpanDescription","extractUrl","isSentryRequest","normalizeRequestArgs","NODE_VERSION","process","versions","node","Http","options","name","id","_breadcrumbs","breadcrumbs","_tracing","tracing","prototype","setupOnce","wrappedHandlerMaker","_createWrappedRequestMethodFactory","httpModule","require","major","httpsModule","breadcrumbsEnabled","tracingEnabled","wrappedRequestMethodFactory","originalRequestMethod","wrappedMethod","args","_i","arguments","length","requestArgs","requestOptions","requestUrl","apply","span","parentSpan","scope","getScope","getSpan","startChild","description","method","op","sentryTraceHeader","toTraceparent","log","headers","__assign","once","res","req","addRequestBreadcrumb","statusCode","setHttpStatus","finish","event","url","getIntegration","addBreadcrumb","category","data","status_code","type","request","response"],"sources":["C:\\Users\\rares\\Desktop\\Blockchain\\Proiect\\node_modules\\@sentry\\node\\src\\integrations\\http.ts"],"sourcesContent":["import { getCurrentHub } from '@sentry/core';\nimport { Integration, Span } from '@sentry/types';\nimport { fill, logger, parseSemver } from '@sentry/utils';\nimport * as http from 'http';\nimport * as https from 'https';\n\nimport {\n  cleanSpanDescription,\n  extractUrl,\n  isSentryRequest,\n  normalizeRequestArgs,\n  RequestMethod,\n  RequestMethodArgs,\n} from './utils/http';\n\nconst NODE_VERSION = parseSemver(process.versions.node);\n\n/** http module integration */\nexport class Http implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'Http';\n\n  /**\n   * @inheritDoc\n   */\n  public name: string = Http.id;\n\n  /**\n   * @inheritDoc\n   */\n  private readonly _breadcrumbs: boolean;\n\n  /**\n   * @inheritDoc\n   */\n  private readonly _tracing: boolean;\n\n  /**\n   * @inheritDoc\n   */\n  public constructor(options: { breadcrumbs?: boolean; tracing?: boolean } = {}) {\n    this._breadcrumbs = typeof options.breadcrumbs === 'undefined' ? true : options.breadcrumbs;\n    this._tracing = typeof options.tracing === 'undefined' ? false : options.tracing;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(): void {\n    // No need to instrument if we don't want to track anything\n    if (!this._breadcrumbs && !this._tracing) {\n      return;\n    }\n\n    const wrappedHandlerMaker = _createWrappedRequestMethodFactory(this._breadcrumbs, this._tracing);\n\n    const httpModule = require('http');\n    fill(httpModule, 'get', wrappedHandlerMaker);\n    fill(httpModule, 'request', wrappedHandlerMaker);\n\n    // NOTE: Prior to Node 9, `https` used internals of `http` module, thus we don't patch it.\n    // If we do, we'd get double breadcrumbs and double spans for `https` calls.\n    // It has been changed in Node 9, so for all versions equal and above, we patch `https` separately.\n    if (NODE_VERSION.major && NODE_VERSION.major > 8) {\n      const httpsModule = require('https');\n      fill(httpsModule, 'get', wrappedHandlerMaker);\n      fill(httpsModule, 'request', wrappedHandlerMaker);\n    }\n  }\n}\n\n// for ease of reading below\ntype OriginalRequestMethod = RequestMethod;\ntype WrappedRequestMethod = RequestMethod;\ntype WrappedRequestMethodFactory = (original: OriginalRequestMethod) => WrappedRequestMethod;\n\n/**\n * Function which creates a function which creates wrapped versions of internal `request` and `get` calls within `http`\n * and `https` modules. (NB: Not a typo - this is a creator^2!)\n *\n * @param breadcrumbsEnabled Whether or not to record outgoing requests as breadcrumbs\n * @param tracingEnabled Whether or not to record outgoing requests as tracing spans\n *\n * @returns A function which accepts the exiting handler and returns a wrapped handler\n */\nfunction _createWrappedRequestMethodFactory(\n  breadcrumbsEnabled: boolean,\n  tracingEnabled: boolean,\n): WrappedRequestMethodFactory {\n  return function wrappedRequestMethodFactory(originalRequestMethod: OriginalRequestMethod): WrappedRequestMethod {\n    return function wrappedMethod(this: typeof http | typeof https, ...args: RequestMethodArgs): http.ClientRequest {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      const httpModule = this;\n\n      const requestArgs = normalizeRequestArgs(args);\n      const requestOptions = requestArgs[0];\n      const requestUrl = extractUrl(requestOptions);\n\n      // we don't want to record requests to Sentry as either breadcrumbs or spans, so just use the original method\n      if (isSentryRequest(requestUrl)) {\n        return originalRequestMethod.apply(httpModule, requestArgs);\n      }\n\n      let span: Span | undefined;\n      let parentSpan: Span | undefined;\n\n      const scope = getCurrentHub().getScope();\n      if (scope && tracingEnabled) {\n        parentSpan = scope.getSpan();\n        if (parentSpan) {\n          span = parentSpan.startChild({\n            description: `${requestOptions.method || 'GET'} ${requestUrl}`,\n            op: 'request',\n          });\n\n          const sentryTraceHeader = span.toTraceparent();\n          logger.log(`[Tracing] Adding sentry-trace header to outgoing request: ${sentryTraceHeader}`);\n          requestOptions.headers = { ...requestOptions.headers, 'sentry-trace': sentryTraceHeader };\n        }\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      return originalRequestMethod\n        .apply(httpModule, requestArgs)\n        .once('response', function(this: http.ClientRequest, res: http.IncomingMessage): void {\n          // eslint-disable-next-line @typescript-eslint/no-this-alias\n          const req = this;\n          if (breadcrumbsEnabled) {\n            addRequestBreadcrumb('response', requestUrl, req, res);\n          }\n          if (tracingEnabled && span) {\n            if (res.statusCode) {\n              span.setHttpStatus(res.statusCode);\n            }\n            span.description = cleanSpanDescription(span.description, requestOptions, req);\n            span.finish();\n          }\n        })\n        .once('error', function(this: http.ClientRequest): void {\n          // eslint-disable-next-line @typescript-eslint/no-this-alias\n          const req = this;\n\n          if (breadcrumbsEnabled) {\n            addRequestBreadcrumb('error', requestUrl, req);\n          }\n          if (tracingEnabled && span) {\n            span.setHttpStatus(500);\n            span.description = cleanSpanDescription(span.description, requestOptions, req);\n            span.finish();\n          }\n        });\n    };\n  };\n}\n\n/**\n * Captures Breadcrumb based on provided request/response pair\n */\nfunction addRequestBreadcrumb(event: string, url: string, req: http.ClientRequest, res?: http.IncomingMessage): void {\n  if (!getCurrentHub().getIntegration(Http)) {\n    return;\n  }\n\n  getCurrentHub().addBreadcrumb(\n    {\n      category: 'http',\n      data: {\n        method: req.method,\n        status_code: res && res.statusCode,\n        url,\n      },\n      type: 'http',\n    },\n    {\n      event,\n      request: req,\n      response: res,\n    },\n  );\n}\n"],"mappings":";AAAA,SAASA,aAAa,QAAQ,cAAc;AAE5C,SAASC,IAAI,EAAEC,MAAM,EAAEC,WAAW,QAAQ,eAAe;AAIzD,SACEC,oBAAoB,EACpBC,UAAU,EACVC,eAAe,EACfC,oBAAoB,QAGf,cAAc;AAErB,IAAMC,YAAY,GAAGL,WAAW,CAACM,OAAO,CAACC,QAAQ,CAACC,IAAI,CAAC;AAEvD;AACA,IAAAC,IAAA;EAqBE;;;EAGA,SAAAA,KAAmBC,OAA0D;IAA1D,IAAAA,OAAA;MAAAA,OAAA,KAA0D;IAAA;IAlB7E;;;IAGO,KAAAC,IAAI,GAAWF,IAAI,CAACG,EAAE;IAgB3B,IAAI,CAACC,YAAY,GAAG,OAAOH,OAAO,CAACI,WAAW,KAAK,WAAW,GAAG,IAAI,GAAGJ,OAAO,CAACI,WAAW;IAC3F,IAAI,CAACC,QAAQ,GAAG,OAAOL,OAAO,CAACM,OAAO,KAAK,WAAW,GAAG,KAAK,GAAGN,OAAO,CAACM,OAAO;EAClF;EAEA;;;EAGOP,IAAA,CAAAQ,SAAA,CAAAC,SAAS,GAAhB;IACE;IACA,IAAI,CAAC,IAAI,CAACL,YAAY,IAAI,CAAC,IAAI,CAACE,QAAQ,EAAE;MACxC;;IAGF,IAAMI,mBAAmB,GAAGC,kCAAkC,CAAC,IAAI,CAACP,YAAY,EAAE,IAAI,CAACE,QAAQ,CAAC;IAEhG,IAAMM,UAAU,GAAGC,OAAO,CAAC,MAAM,CAAC;IAClCxB,IAAI,CAACuB,UAAU,EAAE,KAAK,EAAEF,mBAAmB,CAAC;IAC5CrB,IAAI,CAACuB,UAAU,EAAE,SAAS,EAAEF,mBAAmB,CAAC;IAEhD;IACA;IACA;IACA,IAAId,YAAY,CAACkB,KAAK,IAAIlB,YAAY,CAACkB,KAAK,GAAG,CAAC,EAAE;MAChD,IAAMC,WAAW,GAAGF,OAAO,CAAC,OAAO,CAAC;MACpCxB,IAAI,CAAC0B,WAAW,EAAE,KAAK,EAAEL,mBAAmB,CAAC;MAC7CrB,IAAI,CAAC0B,WAAW,EAAE,SAAS,EAAEL,mBAAmB,CAAC;;EAErD,CAAC;EAnDD;;;EAGcV,IAAA,CAAAG,EAAE,GAAW,MAAM;EAiDnC,OAAAH,IAAC;CAAA,CArDD;SAAaA,IAAI;AA4DjB;;;;;;;;;AASA,SAASW,kCAAkCA,CACzCK,kBAA2B,EAC3BC,cAAuB;EAEvB,OAAO,SAASC,2BAA2BA,CAACC,qBAA4C;IACtF,OAAO,SAASC,aAAaA,CAAA;MAAmC,IAAAC,IAAA;WAAA,IAAAC,EAAA,IAA0B,EAA1BA,EAAA,GAAAC,SAAA,CAAAC,MAA0B,EAA1BF,EAAA,EAA0B;QAA1BD,IAAA,CAAAC,EAAA,IAAAC,SAAA,CAAAD,EAAA;;MAC9D;MACA,IAAMV,UAAU,GAAG,IAAI;MAEvB,IAAMa,WAAW,GAAG9B,oBAAoB,CAAC0B,IAAI,CAAC;MAC9C,IAAMK,cAAc,GAAGD,WAAW,CAAC,CAAC,CAAC;MACrC,IAAME,UAAU,GAAGlC,UAAU,CAACiC,cAAc,CAAC;MAE7C;MACA,IAAIhC,eAAe,CAACiC,UAAU,CAAC,EAAE;QAC/B,OAAOR,qBAAqB,CAACS,KAAK,CAAChB,UAAU,EAAEa,WAAW,CAAC;;MAG7D,IAAII,IAAsB;MAC1B,IAAIC,UAA4B;MAEhC,IAAMC,KAAK,GAAG3C,aAAa,EAAE,CAAC4C,QAAQ,EAAE;MACxC,IAAID,KAAK,IAAId,cAAc,EAAE;QAC3Ba,UAAU,GAAGC,KAAK,CAACE,OAAO,EAAE;QAC5B,IAAIH,UAAU,EAAE;UACdD,IAAI,GAAGC,UAAU,CAACI,UAAU,CAAC;YAC3BC,WAAW,EAAE,CAAGT,cAAc,CAACU,MAAM,IAAI,KAAK,UAAIT,UAAY;YAC9DU,EAAE,EAAE;WACL,CAAC;UAEF,IAAMC,iBAAiB,GAAGT,IAAI,CAACU,aAAa,EAAE;UAC9CjD,MAAM,CAACkD,GAAG,CAAC,+DAA6DF,iBAAmB,CAAC;UAC5FZ,cAAc,CAACe,OAAO,GAAAC,QAAA,CAAAA,QAAA,KAAQhB,cAAc,CAACe,OAAO;YAAE,cAAc,EAAEH;UAAiB,EAAE;;;MAI7F;MACA,OAAOnB,qBAAqB,CACzBS,KAAK,CAAChB,UAAU,EAAEa,WAAW,CAAC,CAC9BkB,IAAI,CAAC,UAAU,EAAE,UAAmCC,GAAyB;QAC5E;QACA,IAAMC,GAAG,GAAG,IAAI;QAChB,IAAI7B,kBAAkB,EAAE;UACtB8B,oBAAoB,CAAC,UAAU,EAAEnB,UAAU,EAAEkB,GAAG,EAAED,GAAG,CAAC;;QAExD,IAAI3B,cAAc,IAAIY,IAAI,EAAE;UAC1B,IAAIe,GAAG,CAACG,UAAU,EAAE;YAClBlB,IAAI,CAACmB,aAAa,CAACJ,GAAG,CAACG,UAAU,CAAC;;UAEpClB,IAAI,CAACM,WAAW,GAAG3C,oBAAoB,CAACqC,IAAI,CAACM,WAAW,EAAET,cAAc,EAAEmB,GAAG,CAAC;UAC9EhB,IAAI,CAACoB,MAAM,EAAE;;MAEjB,CAAC,CAAC,CACDN,IAAI,CAAC,OAAO,EAAE;QACb;QACA,IAAME,GAAG,GAAG,IAAI;QAEhB,IAAI7B,kBAAkB,EAAE;UACtB8B,oBAAoB,CAAC,OAAO,EAAEnB,UAAU,EAAEkB,GAAG,CAAC;;QAEhD,IAAI5B,cAAc,IAAIY,IAAI,EAAE;UAC1BA,IAAI,CAACmB,aAAa,CAAC,GAAG,CAAC;UACvBnB,IAAI,CAACM,WAAW,GAAG3C,oBAAoB,CAACqC,IAAI,CAACM,WAAW,EAAET,cAAc,EAAEmB,GAAG,CAAC;UAC9EhB,IAAI,CAACoB,MAAM,EAAE;;MAEjB,CAAC,CAAC;IACN,CAAC;EACH,CAAC;AACH;AAEA;;;AAGA,SAASH,oBAAoBA,CAACI,KAAa,EAAEC,GAAW,EAAEN,GAAuB,EAAED,GAA0B;EAC3G,IAAI,CAACxD,aAAa,EAAE,CAACgE,cAAc,CAACpD,IAAI,CAAC,EAAE;IACzC;;EAGFZ,aAAa,EAAE,CAACiE,aAAa,CAC3B;IACEC,QAAQ,EAAE,MAAM;IAChBC,IAAI,EAAE;MACJnB,MAAM,EAAES,GAAG,CAACT,MAAM;MAClBoB,WAAW,EAAEZ,GAAG,IAAIA,GAAG,CAACG,UAAU;MAClCI,GAAG,EAAAA;KACJ;IACDM,IAAI,EAAE;GACP,EACD;IACEP,KAAK,EAAAA,KAAA;IACLQ,OAAO,EAAEb,GAAG;IACZc,QAAQ,EAAEf;GACX,CACF;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}