{"ast":null,"code":"import { dynamicRequire, fill, logger } from '@sentry/utils';\n/** Tracing integration for node-postgres package */\nvar Postgres = /** @class */function () {\n  function Postgres() {\n    /**\n     * @inheritDoc\n     */\n    this.name = Postgres.id;\n  }\n  /**\n   * @inheritDoc\n   */\n  Postgres.prototype.setupOnce = function (_, getCurrentHub) {\n    var client;\n    try {\n      var pgModule = dynamicRequire(module, 'pg');\n      client = pgModule.Client;\n    } catch (e) {\n      logger.error('Postgres Integration was unable to require `pg` package.');\n      return;\n    }\n    /**\n     * function (query, callback) => void\n     * function (query, params, callback) => void\n     * function (query) => Promise\n     * function (query, params) => Promise\n     */\n    fill(client.prototype, 'query', function (orig) {\n      return function (config, values, callback) {\n        var _a, _b;\n        var scope = getCurrentHub().getScope();\n        var parentSpan = (_a = scope) === null || _a === void 0 ? void 0 : _a.getSpan();\n        var span = (_b = parentSpan) === null || _b === void 0 ? void 0 : _b.startChild({\n          description: typeof config === 'string' ? config : config.text,\n          op: \"db\"\n        });\n        if (typeof callback === 'function') {\n          return orig.call(this, config, values, function (err, result) {\n            var _a;\n            (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n            callback(err, result);\n          });\n        }\n        if (typeof values === 'function') {\n          return orig.call(this, config, function (err, result) {\n            var _a;\n            (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n            values(err, result);\n          });\n        }\n        return orig.call(this, config, values).then(function (res) {\n          var _a;\n          (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n          return res;\n        });\n      };\n    });\n  };\n  /**\n   * @inheritDoc\n   */\n  Postgres.id = 'Postgres';\n  return Postgres;\n}();\nexport { Postgres };","map":{"version":3,"names":["dynamicRequire","fill","logger","Postgres","name","id","prototype","setupOnce","_","getCurrentHub","client","pgModule","module","Client","e","error","orig","config","values","callback","scope","getScope","parentSpan","_a","getSpan","span","_b","startChild","description","text","op","call","err","result","finish","then","res"],"sources":["C:\\Users\\rares\\Desktop\\Blockchain\\Proiect\\node_modules\\@sentry\\tracing\\src\\integrations\\postgres.ts"],"sourcesContent":["import { Hub } from '@sentry/hub';\nimport { EventProcessor, Integration } from '@sentry/types';\nimport { dynamicRequire, fill, logger } from '@sentry/utils';\n\ninterface PgClient {\n  prototype: {\n    query: () => void | Promise<unknown>;\n  };\n}\n\n/** Tracing integration for node-postgres package */\nexport class Postgres implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'Postgres';\n\n  /**\n   * @inheritDoc\n   */\n  public name: string = Postgres.id;\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(_: (callback: EventProcessor) => void, getCurrentHub: () => Hub): void {\n    let client: PgClient;\n\n    try {\n      const pgModule = dynamicRequire(module, 'pg') as { Client: PgClient };\n      client = pgModule.Client;\n    } catch (e) {\n      logger.error('Postgres Integration was unable to require `pg` package.');\n      return;\n    }\n\n    /**\n     * function (query, callback) => void\n     * function (query, params, callback) => void\n     * function (query) => Promise\n     * function (query, params) => Promise\n     */\n    fill(client.prototype, 'query', function(orig: () => void | Promise<unknown>) {\n      return function(this: unknown, config: unknown, values: unknown, callback: unknown) {\n        const scope = getCurrentHub().getScope();\n        const parentSpan = scope?.getSpan();\n        const span = parentSpan?.startChild({\n          description: typeof config === 'string' ? config : (config as { text: string }).text,\n          op: `db`,\n        });\n\n        if (typeof callback === 'function') {\n          return orig.call(this, config, values, function(err: Error, result: unknown) {\n            span?.finish();\n            callback(err, result);\n          });\n        }\n\n        if (typeof values === 'function') {\n          return orig.call(this, config, function(err: Error, result: unknown) {\n            span?.finish();\n            values(err, result);\n          });\n        }\n\n        return (orig.call(this, config, values) as Promise<unknown>).then((res: unknown) => {\n          span?.finish();\n          return res;\n        });\n      };\n    });\n  }\n}\n"],"mappings":"AAEA,SAASA,cAAc,EAAEC,IAAI,EAAEC,MAAM,QAAQ,eAAe;AAQ5D;AACA,IAAAC,QAAA;EAAA,SAAAA,SAAA;IAME;;;IAGO,KAAAC,IAAI,GAAWD,QAAQ,CAACE,EAAE;EAoDnC;EAlDE;;;EAGOF,QAAA,CAAAG,SAAA,CAAAC,SAAS,GAAhB,UAAiBC,CAAqC,EAAEC,aAAwB;IAC9E,IAAIC,MAAgB;IAEpB,IAAI;MACF,IAAMC,QAAQ,GAAGX,cAAc,CAACY,MAAM,EAAE,IAAI,CAAyB;MACrEF,MAAM,GAAGC,QAAQ,CAACE,MAAM;KACzB,CAAC,OAAOC,CAAC,EAAE;MACVZ,MAAM,CAACa,KAAK,CAAC,0DAA0D,CAAC;MACxE;;IAGF;;;;;;IAMAd,IAAI,CAACS,MAAM,CAACJ,SAAS,EAAE,OAAO,EAAE,UAASU,IAAmC;MAC1E,OAAO,UAAwBC,MAAe,EAAEC,MAAe,EAAEC,QAAiB;;QAChF,IAAMC,KAAK,GAAGX,aAAa,EAAE,CAACY,QAAQ,EAAE;QACxC,IAAMC,UAAU,IAAAC,EAAA,GAAGH,KAAK,cAAAG,EAAA,uBAAAA,EAAA,CAAEC,OAAO,EAAE;QACnC,IAAMC,IAAI,IAAAC,EAAA,GAAGJ,UAAU,cAAAI,EAAA,uBAAAA,EAAA,CAAEC,UAAU,CAAC;UAClCC,WAAW,EAAE,OAAOX,MAAM,KAAK,QAAQ,GAAGA,MAAM,GAAIA,MAA2B,CAACY,IAAI;UACpFC,EAAE,EAAE;SACL,CAAC;QAEF,IAAI,OAAOX,QAAQ,KAAK,UAAU,EAAE;UAClC,OAAOH,IAAI,CAACe,IAAI,CAAC,IAAI,EAAEd,MAAM,EAAEC,MAAM,EAAE,UAASc,GAAU,EAAEC,MAAe;;YACzE,CAAAV,EAAA,GAAAE,IAAI,cAAAF,EAAA,uBAAAA,EAAA,CAAEW,MAAM;YACZf,QAAQ,CAACa,GAAG,EAAEC,MAAM,CAAC;UACvB,CAAC,CAAC;;QAGJ,IAAI,OAAOf,MAAM,KAAK,UAAU,EAAE;UAChC,OAAOF,IAAI,CAACe,IAAI,CAAC,IAAI,EAAEd,MAAM,EAAE,UAASe,GAAU,EAAEC,MAAe;;YACjE,CAAAV,EAAA,GAAAE,IAAI,cAAAF,EAAA,uBAAAA,EAAA,CAAEW,MAAM;YACZhB,MAAM,CAACc,GAAG,EAAEC,MAAM,CAAC;UACrB,CAAC,CAAC;;QAGJ,OAAQjB,IAAI,CAACe,IAAI,CAAC,IAAI,EAAEd,MAAM,EAAEC,MAAM,CAAsB,CAACiB,IAAI,CAAC,UAACC,GAAY;;UAC7E,CAAAb,EAAA,GAAAE,IAAI,cAAAF,EAAA,uBAAAA,EAAA,CAAEW,MAAM;UACZ,OAAOE,GAAG;QACZ,CAAC,CAAC;MACJ,CAAC;IACH,CAAC,CAAC;EACJ,CAAC;EA3DD;;;EAGcjC,QAAA,CAAAE,EAAE,GAAW,UAAU;EAyDvC,OAAAF,QAAC;CAAA,CA7DD;SAAaA,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}