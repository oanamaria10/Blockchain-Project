{"ast":null,"code":"export * from '@web3-storage/access/space';\nimport * as Usage from './capability/usage.js';\nimport * as API from './types.js';\n/**\n * @typedef {object} Model\n * @property {API.SpaceDID} id\n * @property {{name?:string}} [meta]\n * @property {API.Agent} agent\n */\nexport class Space {\n  #model;\n  /**\n   * @param {Model} model\n   */\n  constructor(model) {\n    this.#model = model;\n    this.usage = new StorageUsage(model);\n  }\n  /**\n   * The given space name.\n   */\n  get name() {\n    /* c8 ignore next */\n    return String(this.#model.meta?.name ?? '');\n  }\n  /**\n   * The DID of the space.\n   */\n  did() {\n    return this.#model.id;\n  }\n  /**\n   * User defined space metadata.\n   */\n  meta() {\n    return this.#model.meta;\n  }\n}\nexport class StorageUsage {\n  #model;\n  /**\n   * @param {Model} model\n   */\n  constructor(model) {\n    this.#model = model;\n  }\n  /**\n   * Get the current usage in bytes.\n   */\n  async get() {\n    const {\n      agent\n    } = this.#model;\n    const space = this.#model.id;\n    const now = new Date();\n    const period = {\n      // we may not have done a snapshot for this month _yet_, so get report\n      // from last month -> now\n      from: startOfLastMonth(now),\n      to: now\n    };\n    const result = await Usage.report({\n      agent\n    }, {\n      space,\n      period\n    });\n    /* c8 ignore next */\n    if (result.error) return result;\n    const provider = /** @type {API.ProviderDID} */agent.connection.id.did();\n    const report = result.ok[provider];\n    return {\n      /* c8 ignore next */\n      ok: report?.size.final == null ? undefined : BigInt(report.size.final)\n    };\n  }\n}\n/** @param {string|number|Date} now */\nconst startOfMonth = now => {\n  const d = new Date(now);\n  d.setUTCDate(1);\n  d.setUTCHours(0);\n  d.setUTCMinutes(0);\n  d.setUTCSeconds(0);\n  d.setUTCMilliseconds(0);\n  return d;\n};\n/** @param {string|number|Date} now */\nconst startOfLastMonth = now => {\n  const d = startOfMonth(now);\n  d.setUTCMonth(d.getUTCMonth() - 1);\n  return d;\n};","map":{"version":3,"names":["Usage","API","Space","model","constructor","usage","StorageUsage","name","String","meta","did","id","get","agent","space","now","Date","period","from","startOfLastMonth","to","result","report","error","provider","connection","ok","size","final","undefined","BigInt","startOfMonth","d","setUTCDate","setUTCHours","setUTCMinutes","setUTCSeconds","setUTCMilliseconds","setUTCMonth","getUTCMonth"],"sources":["../../src/space.js"],"sourcesContent":[null],"mappings":"AAAA,cAAc,4BAA4B;AAC1C,OAAO,KAAKA,KAAK,MAAM,uBAAuB;AAC9C,OAAO,KAAKC,GAAG,MAAM,YAAY;AAEjC;;;;;;AAOA,OAAM,MAAOC,KAAK;EAChB,CAAAC,KAAM;EAEN;;;EAGAC,YAAYD,KAAK;IACf,IAAI,CAAC,CAAAA,KAAM,GAAGA,KAAK;IACnB,IAAI,CAACE,KAAK,GAAG,IAAIC,YAAY,CAACH,KAAK,CAAC;EACtC;EAEA;;;EAGA,IAAII,IAAIA,CAAA;IACN;IACA,OAAOC,MAAM,CAAC,IAAI,CAAC,CAAAL,KAAM,CAACM,IAAI,EAAEF,IAAI,IAAI,EAAE,CAAC;EAC7C;EAEA;;;EAGAG,GAAGA,CAAA;IACD,OAAO,IAAI,CAAC,CAAAP,KAAM,CAACQ,EAAE;EACvB;EAEA;;;EAGAF,IAAIA,CAAA;IACF,OAAO,IAAI,CAAC,CAAAN,KAAM,CAACM,IAAI;EACzB;;AAGF,OAAM,MAAOH,YAAY;EACvB,CAAAH,KAAM;EAEN;;;EAGAC,YAAYD,KAAK;IACf,IAAI,CAAC,CAAAA,KAAM,GAAGA,KAAK;EACrB;EAEA;;;EAGA,MAAMS,GAAGA,CAAA;IACP,MAAM;MAAEC;IAAK,CAAE,GAAG,IAAI,CAAC,CAAAV,KAAM;IAC7B,MAAMW,KAAK,GAAG,IAAI,CAAC,CAAAX,KAAM,CAACQ,EAAE;IAC5B,MAAMI,GAAG,GAAG,IAAIC,IAAI,EAAE;IACtB,MAAMC,MAAM,GAAG;MACb;MACA;MACAC,IAAI,EAAEC,gBAAgB,CAACJ,GAAG,CAAC;MAC3BK,EAAE,EAAEL;KACL;IACD,MAAMM,MAAM,GAAG,MAAMrB,KAAK,CAACsB,MAAM,CAAC;MAAET;IAAK,CAAE,EAAE;MAAEC,KAAK;MAAEG;IAAM,CAAE,CAAC;IAC/D;IACA,IAAII,MAAM,CAACE,KAAK,EAAE,OAAOF,MAAM;IAE/B,MAAMG,QAAQ,GAAG,8BAAgCX,KAAK,CAACY,UAAU,CAACd,EAAE,CAACD,GAAG,EAAG;IAC3E,MAAMY,MAAM,GAAGD,MAAM,CAACK,EAAE,CAACF,QAAQ,CAAC;IAElC,OAAO;MACL;MACAE,EAAE,EAAEJ,MAAM,EAAEK,IAAI,CAACC,KAAK,IAAI,IAAI,GAAGC,SAAS,GAAGC,MAAM,CAACR,MAAM,CAACK,IAAI,CAACC,KAAK;KACtE;EACH;;AAGF;AACA,MAAMG,YAAY,GAAIhB,GAAG,IAAI;EAC3B,MAAMiB,CAAC,GAAG,IAAIhB,IAAI,CAACD,GAAG,CAAC;EACvBiB,CAAC,CAACC,UAAU,CAAC,CAAC,CAAC;EACfD,CAAC,CAACE,WAAW,CAAC,CAAC,CAAC;EAChBF,CAAC,CAACG,aAAa,CAAC,CAAC,CAAC;EAClBH,CAAC,CAACI,aAAa,CAAC,CAAC,CAAC;EAClBJ,CAAC,CAACK,kBAAkB,CAAC,CAAC,CAAC;EACvB,OAAOL,CAAC;AACV,CAAC;AAED;AACA,MAAMb,gBAAgB,GAAIJ,GAAG,IAAI;EAC/B,MAAMiB,CAAC,GAAGD,YAAY,CAAChB,GAAG,CAAC;EAC3BiB,CAAC,CAACM,WAAW,CAACN,CAAC,CAACO,WAAW,EAAE,GAAG,CAAC,CAAC;EAClC,OAAOP,CAAC;AACV,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}