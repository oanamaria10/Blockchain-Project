{"ast":null,"code":"import { Base } from '../base.js';\nimport * as Agent from '@web3-storage/access/agent';\nimport * as DIDMailto from '@web3-storage/did-mailto';\nimport * as Result from '../result.js';\nimport * as API from '../types.js';\nexport { DIDMailto };\n/**\n * Client for interacting with the `access/*` capabilities.\n */\nexport class AccessClient extends Base {\n  /* c8 ignore start - testing websocket code is hard */\n  /**\n   * Authorize the current agent to use capabilities granted to the passed\n   * email account.\n   *\n   * @deprecated Use `request` instead.\n   *\n   * @param {`${string}@${string}`} email\n   * @param {object} [options]\n   * @param {AbortSignal} [options.signal]\n   * @param {Iterable<{ can: API.Ability }>} [options.capabilities]\n   */\n  async authorize(email, options) {\n    const account = DIDMailto.fromEmail(email);\n    const authorization = Result.unwrap(await request(this, {\n      account\n    }));\n    const access = Result.unwrap(await authorization.claim(options));\n    await Result.unwrap(await access.save());\n    return access.proofs;\n  }\n  /* c8 ignore stop */\n  /**\n   * Claim delegations granted to the account associated with this agent.\n   *\n   * @param {object} [input]\n   * @param {API.DID} [input.audience]\n   */\n  async claim(input) {\n    const access = Result.unwrap(await claim(this, input));\n    await Result.unwrap(await access.save());\n    return access.proofs;\n  }\n  /**\n   * Requests specified `access` level from the account from the given account.\n   *\n   * @param {object} input\n   * @param {API.AccountDID} input.account\n   * @param {API.Access} [input.access]\n   * @param {AbortSignal} [input.signal]\n   */\n  async request(input) {\n    return await request(this, input);\n  }\n  /**\n   * Shares access with delegates.\n   *\n   * @param {object} input\n   * @param {API.Delegation[]} input.delegations\n   * @param {API.SpaceDID} [input.space]\n   * @param {API.Delegation[]} [input.proofs]\n   */\n  async delegate(input) {\n    return await delegate(this, input);\n  }\n}\n/**\n * @param {{agent: API.Agent}} client\n * @param {object} [input]\n * @param {API.DID} [input.audience]\n */\nexport const claim = async ({\n  agent\n}, input) => Agent.Access.claim(agent, input);\n/**\n * Requests specified `access` level from specified `account`. It will invoke\n * `access/authorize` capability and keep polling `access/claim` capability\n * until access is granted or request is aborted.\n *\n * @param {{agent: API.Agent}} agent\n * @param {object} input\n * @param {API.AccountDID} input.account\n * @param {API.Access} [input.access]\n * @param {API.DID} [input.audience]\n */\nexport const request = async ({\n  agent\n}, input) => Agent.Access.request(agent, input);\n/**\n *\n * @param {{agent: API.Agent}} agent\n * @param {object} input\n * @param {API.Delegation[]} input.delegations\n * @param {API.SpaceDID} [input.space]\n * @param {API.Delegation[]} [input.proofs]\n */\nexport const delegate = async ({\n  agent\n}, input) => Agent.Access.delegate(agent, input);\nexport const {\n  spaceAccess,\n  accountAccess\n} = Agent.Access;","map":{"version":3,"names":["Base","Agent","DIDMailto","Result","API","AccessClient","authorize","email","options","account","fromEmail","authorization","unwrap","request","access","claim","save","proofs","input","delegate","agent","Access","spaceAccess","accountAccess"],"sources":["../../../src/capability/access.js"],"sourcesContent":[null],"mappings":"AAAA,SAASA,IAAI,QAAQ,YAAY;AACjC,OAAO,KAAKC,KAAK,MAAM,4BAA4B;AACnD,OAAO,KAAKC,SAAS,MAAM,0BAA0B;AACrD,OAAO,KAAKC,MAAM,MAAM,cAAc;AAEtC,OAAO,KAAKC,GAAG,MAAM,aAAa;AAElC,SAASF,SAAS;AAElB;;;AAGA,OAAM,MAAOG,YAAa,SAAQL,IAAI;EACpC;EACA;;;;;;;;;;;EAWA,MAAMM,SAASA,CAACC,KAAK,EAAEC,OAAO;IAC5B,MAAMC,OAAO,GAAGP,SAAS,CAACQ,SAAS,CAACH,KAAK,CAAC;IAC1C,MAAMI,aAAa,GAAGR,MAAM,CAACS,MAAM,CAAC,MAAMC,OAAO,CAAC,IAAI,EAAE;MAAEJ;IAAO,CAAE,CAAC,CAAC;IACrE,MAAMK,MAAM,GAAGX,MAAM,CAACS,MAAM,CAAC,MAAMD,aAAa,CAACI,KAAK,CAACP,OAAO,CAAC,CAAC;IAChE,MAAML,MAAM,CAACS,MAAM,CAAC,MAAME,MAAM,CAACE,IAAI,EAAE,CAAC;IAExC,OAAOF,MAAM,CAACG,MAAM;EACtB;EACA;EAEA;;;;;;EAMA,MAAMF,KAAKA,CAACG,KAAK;IACf,MAAMJ,MAAM,GAAGX,MAAM,CAACS,MAAM,CAAC,MAAMG,KAAK,CAAC,IAAI,EAAEG,KAAK,CAAC,CAAC;IACtD,MAAMf,MAAM,CAACS,MAAM,CAAC,MAAME,MAAM,CAACE,IAAI,EAAE,CAAC;IACxC,OAAOF,MAAM,CAACG,MAAM;EACtB;EAEA;;;;;;;;EAQA,MAAMJ,OAAOA,CAACK,KAAK;IACjB,OAAO,MAAML,OAAO,CAAC,IAAI,EAAEK,KAAK,CAAC;EACnC;EAEA;;;;;;;;EAQA,MAAMC,QAAQA,CAACD,KAAK;IAClB,OAAO,MAAMC,QAAQ,CAAC,IAAI,EAAED,KAAK,CAAC;EACpC;;AAGF;;;;;AAKA,OAAO,MAAMH,KAAK,GAAG,MAAAA,CAAO;EAAEK;AAAK,CAAE,EAAEF,KAAK,KAC1CjB,KAAK,CAACoB,MAAM,CAACN,KAAK,CAACK,KAAK,EAAEF,KAAK,CAAC;AAElC;;;;;;;;;;;AAWA,OAAO,MAAML,OAAO,GAAG,MAAAA,CAAO;EAAEO;AAAK,CAAE,EAAEF,KAAK,KAC5CjB,KAAK,CAACoB,MAAM,CAACR,OAAO,CAACO,KAAK,EAAEF,KAAK,CAAC;AAEpC;;;;;;;;AAQA,OAAO,MAAMC,QAAQ,GAAG,MAAAA,CAAO;EAAEC;AAAK,CAAE,EAAEF,KAAK,KAC7CjB,KAAK,CAACoB,MAAM,CAACF,QAAQ,CAACC,KAAK,EAAEF,KAAK,CAAC;AAErC,OAAO,MAAM;EAAEI,WAAW;EAAEC;AAAa,CAAE,GAAGtB,KAAK,CAACoB,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}